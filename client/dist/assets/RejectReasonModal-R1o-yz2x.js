const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ViewVendorModal-JcQLL4zm.js","assets/index-oHO_bMXB.js","assets/index-CdwHP-N2.css","assets/proxy-BAV5dLxe.js","assets/ProfileReviewModal-GraQ_VlO.js","assets/KycConfirmationModal-CeLhsDmG.js"])))=>i.map(i=>d[i]);
import{j as e,r as n,bq as oe,br as ae,bs as me,bt as le,bu as xe,bv as ue,a$ as pe,aY as he,bw as be,bx as ne,by as je,bz as ge,bA as fe,y as O,bB as Ne,_ as G}from"./index-oHO_bMXB.js";import{f as ie}from"./format-PgvnqH7J.js";import{M as B}from"./ModalPortal-CaX2GLzp.js";function ye({percentage:s}){const c=l=>l<30?"bg-error":l<70?"bg-warning":"bg-success";return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-bold",children:"Profile Completion"}),e.jsxs("span",{className:"text-sm font-extrabold",children:[s,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:`h-2.5 rounded-full ${c(s)}`,style:{width:`${s}%`}})})]})}function Se({vendor:s,index:c,activeTab:l,onView:o,onReview:r,onApprove:u,onReject:j,onMarkDefaultStockist:p,onMarkKycCompleted:m,onToggleStatus:y,onAssignStockist:P,isLoadingAction:S,currentActionId:d,setShowKycModal:w,setSelectedVendor:k,role:i}){var Q,J,W,X,Z,ee,se,te;const[D,C]=n.useState({approve:!1,reject:!1,status:!1,default:!1}),{data:v,isLoading:g,refetch:I}=oe(s.id,{skip:!["active","suspended"].includes(l)||i!=="reseller"});n.useEffect(()=>{["active","suspended"].includes(l)&&i==="reseller"&&I()},[s.id,l,i,I]);const V=s.created_at?ie(new Date(s.created_at),"MMM dd, yyyy HH:mm"):"N/A",A=((Q=s.profile)==null?void 0:Q.full_name)||(s==null?void 0:s.username),N=((J=s.profile)==null?void 0:J.phone)||(s==null?void 0:s.phone),Y=((W=s.profile)==null?void 0:W.created_at)||"N/A",L=((X=s.address)==null?void 0:X.state)||"N/A",T=((Z=s.address)==null?void 0:Z.postal_code)||"N/A",H=((ee=s.address)==null?void 0:ee.city)||"N/A",E=((se=s.user)==null?void 0:se.id)||s.id,z=(te=s.profile)==null?void 0:te.kyc_verified,K=(s==null?void 0:s.completion_percentage)||0,M=K>=80,_=s.is_default_user||!1,f=v==null?void 0:v.stockist,q=async(a,b,...x)=>{if(a==="kyc"){k(s),w(!0);return}C(F=>({...F,[a]:!0}));try{await b(...x)}finally{C(F=>({...F,[a]:!1}))}},$=(a,b=null)=>{const x=S&&(d===a||d===`default-${b}`||d===E),F=D[a];return{loading:x||F,disabled:x||F}},R=(a,b,x,F="primary")=>{const{disabled:de}=$(a);return e.jsx("button",{className:`btn btn-sm btn-${F} font-bold`,onClick:()=>{a==="approve"?u(s.id):a==="reject"?j(s.id):a==="kyc"&&m(s.id)},disabled:de||S&&d===a,children:S&&d===a?e.jsx("span",{className:"loading loading-spinner loading-xs"}):e.jsxs(e.Fragment,{children:[b," ",x]})})},U=()=>{const{loading:a,disabled:b}=$("status"),x=l==="active";return e.jsx("button",{className:`btn btn-sm btn-${x?"warning":"success"} font-bold`,onClick:()=>q("status",y,E),disabled:b,children:a?e.jsx("span",{className:"loading loading-spinner loading-xs"}):e.jsxs(e.Fragment,{children:[x?e.jsx(me,{}):e.jsx(le,{}),x?"In-Active":"Activate"]})})},t=()=>{const{loading:a,disabled:b}=$("default",E);return e.jsx("button",{className:`btn btn-sm ${_?"btn-warning":"btn-outline"} font-bold`,onClick:()=>q("default",p,E,!_),disabled:b,title:_?"Remove as default stockist":"Set as default stockist",children:a?e.jsx("span",{className:"loading loading-spinner loading-xs"}):e.jsxs(e.Fragment,{children:[_?e.jsx(xe,{className:"text-yellow-500"}):e.jsx(ue,{}),_?"Remove Default":"Mark Default"]})})},h=()=>{const{loading:a,disabled:b}=$("kyc"),x=b||!M;return e.jsxs("div",{className:"relative group",children:[e.jsx("button",{className:`btn btn-sm ${M?"btn-primary":"btn-disabled"} font-bold`,onClick:()=>{M&&(k(s),w(!0))},disabled:x,children:a?e.jsx("span",{className:"loading loading-spinner loading-xs"}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{})," Full KYC Approved"]})}),!M&&e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 bottom-full mb-2 hidden group-hover:block w-64 bg-gray-800 text-white text-xs rounded p-2 z-10",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"mr-1"}),"Profile completion must be at least 80% to enable this button."]})})]})},ce=()=>{if(i!=="reseller"||!["active","suspended"].includes(l))return null;const a=f?`${f.username} (${f.email})`:"Not Assigned";return e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:f?"text-green-600 font-semibold":"text-red-600 font-semibold",children:a}),f&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Assigned: ",ie(new Date(f.assigned_at),"MMM dd, yyyy")]})]})}),e.jsx("td",{className:"px-2 py-3",children:e.jsx("button",{className:"btn btn-sm btn-outline btn-primary font-bold",onClick:()=>P(s,f),disabled:S||g,children:g?e.jsx("span",{className:"loading loading-spinner loading-xs"}):e.jsxs(e.Fragment,{children:[e.jsx(be,{})," ",f?"Change":"Assign"]})})})]})},re=(()=>{switch(l){case"new":return e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-2 py-3 font-bold",children:["# ",c+1]}),e.jsx("td",{className:"px-2 py-3",children:V}),e.jsx("td",{className:"px-2 py-3",children:A}),e.jsx("td",{className:"px-2 py-3",children:s.email}),e.jsx("td",{className:"px-2 py-3",children:N}),e.jsx("td",{className:"px-2 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[R("approve",e.jsx(je,{}),"Approve","success"),R("reject",e.jsx(ne,{}),"Reject","error")]})})]});case"pending":return e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-2 py-3 font-bold",children:["# ",c+1]}),e.jsx("td",{className:"px-2 py-3",children:V}),e.jsx("td",{className:"px-2 py-3",children:A}),e.jsx("td",{className:"px-2 py-3",children:s.email}),e.jsx("td",{className:"px-2 py-3",children:N}),e.jsx("td",{className:"px-2 py-3",children:e.jsx(ye,{percentage:K})}),e.jsx("td",{className:"px-2 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{className:"btn btn-sm btn-ghost font-bold border-1 border-indigo-400",onClick:a=>{a.stopPropagation(),r()},children:[e.jsx(ae,{})," Review"]}),h(),R("reject",e.jsx(ne,{}),"Reject","error")]})})]});case"rejected":return e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-2 py-3 font-bold",children:["# ",c+1]}),e.jsx("td",{className:"px-2 py-3",children:V}),e.jsx("td",{className:"px-2 py-3",children:s.email}),e.jsx("td",{className:"px-2 py-3",children:A}),e.jsx("td",{className:"px-2 py-3",children:N}),e.jsx("td",{className:"px-2 py-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:R("approve",e.jsx(le,{}),"Re-Activate","success")})})]});case"active":case"suspended":return e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-3 font-bold",children:s.unique_role_id||"N/A"}),e.jsx("td",{className:"px-2 py-3",children:Y}),e.jsxs("td",{className:"px-2 py-3",children:[A,e.jsx("div",{className:z?"text-green-600 font-semibold":"text-red-600 font-semibold",children:z?"KYC: Approved":"KYC: Pending"})]}),e.jsx("td",{className:"px-2 py-3 font-bold",children:s.email}),e.jsx("td",{className:"px-2 py-3",children:N}),e.jsx("td",{className:"px-2 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.business_name||"N/A"}),e.jsx("span",{className:"text-sm text-gray-500",children:s.business_type||"N/A"})]})}),e.jsxs("td",{className:"px-2 py-3",children:[H,", ",L,", ",T]}),i==="reseller"&&ce(),i==="stockist"&&e.jsx("td",{className:"px-2 py-3 text-center",children:_?e.jsx("span",{className:"badge badge-success badge-lg",children:"True"}):e.jsx("span",{className:"badge badge-secondary badge-lg",children:"False"})}),e.jsx("td",{className:"px-2 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{className:"btn btn-sm btn-ghost font-bold",onClick:a=>{a.stopPropagation(),o()},children:[e.jsx(ae,{})," View"]}),U(),i==="stockist"&&t()]})})]});default:return null}})();return e.jsx("tr",{className:"hover:bg-gray-50 cursor-pointer transition-colors",children:re})}function we({isOpen:s,onClose:c,reseller:l,currentStockist:o}){var k;const[r,u]=n.useState(""),[j,p]=n.useState(!1),{data:m,isLoading:y,refetch:P}=ge(void 0,{skip:!s}),[S]=fe();n.useEffect(()=>{s&&(P(),u(o?o.id:""))},[s,o,P]);const d=async i=>{var D;if(i.preventDefault(),!r){O.error("Please select a stockist");return}p(!0);try{await S({resellerId:l.id,stockistId:r}).unwrap(),O.success("Stockist assigned successfully"),c()}catch(C){O.error(((D=C==null?void 0:C.data)==null?void 0:D.message)||"Failed to assign stockist")}finally{p(!1)}},w=()=>{u(""),c()};return s?e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Assign Stockist to Reseller"}),e.jsx("button",{onClick:w,className:"btn btn-sm btn-circle",children:"Ã—"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Reseller:"})," ",l.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",l.email]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-warning mt-2",children:[e.jsx("strong",{children:"Current Stockist:"})," ",o.username]}),e.jsxs("p",{className:"text-warning mt-2",children:["(",o.email||"N/A",")"]})]})]}),e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"form-control mb-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-semibold",children:"Select Stockist"})}),e.jsxs("select",{className:"select select-bordered w-full",value:r,onChange:i=>u(i.target.value),disabled:y,required:!0,children:[e.jsx("option",{value:"",children:"Choose a stockist"}),(k=m==null?void 0:m.stockists)==null?void 0:k.map(i=>e.jsxs("option",{value:i.id,children:[i.username," - ",i.email]},i.id))]}),y&&e.jsxs("div",{className:"flex items-center mt-2 text-sm text-gray-600",children:[e.jsx("span",{className:"loading loading-spinner loading-xs mr-2"}),"Loading stockists..."]})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:w,disabled:j,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:j||!r||y,children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner loading-xs mr-2"}),"Assigning..."]}):o?"Update Assignment":"Assign Stockist"})]})]})]})}):null}const ke=n.lazy(()=>G(()=>import("./ViewVendorModal-JcQLL4zm.js"),__vite__mapDeps([0,1,2,3]))),Ce=n.lazy(()=>G(()=>import("./ProfileReviewModal-GraQ_VlO.js"),__vite__mapDeps([4,1,2]))),ve=n.lazy(()=>G(()=>import("./KycConfirmationModal-CeLhsDmG.js"),__vite__mapDeps([5,1,2]))),Ae=[{id:"new",label:"New Request"},{id:"pending",label:"Processing"},{id:"rejected",label:"Rejected"},{id:"active",label:"Active"},{id:"suspended",label:"Inactive"}];function Pe({data:s,activeTab:c,setActiveTab:l,onApprove:o,onReject:r,onMarkDefaultStockist:u,onSearch:j,onRefresh:p,isLoading:m,isLoadingAction:y,currentActionId:P,MarkFullKyc:S,role:d}){var U;const[w,k]=n.useState(null),[i,D]=n.useState(null),[C,v]=n.useState(!1),[g,I]=n.useState(null),[V,A]=n.useState(""),[N,Y]=n.useState("email"),[L,T]=n.useState(!1),[H,E]=n.useState(null),[z,K]=n.useState(null),M=()=>{j(V,N)},_=()=>{A(""),j("",N)},f=()=>{p("all")},q=async()=>{g&&(await S(g==null?void 0:g.id),v(!1))},$=(t,h=null)=>{E(t),K(h),T(!0)},R=()=>{const t=()=>{switch(d){case"stockist":return"Stockist ID";case"reseller":return"Reseller ID";default:return"Vendor ID"}};switch(c){case"new":return["Sr.No","Created Date","Full Name","Email","Phone Number","Actions"];case"pending":return["Sr.No","Created Date","Name","Email","Phone","Profile %","Actions"];case"rejected":return["Sr.No","Created Date","Email","Full Name","Phone","Actions"];case"active":case"suspended":const h=[t(),"Created Date","Name","Email","Phone","Business","Location"];return d==="reseller"&&(h.push("Assigned Stockist"),h.push("Stockist Action")),d==="stockist"&&h.push("Default Stockist"),h.push("Actions"),h;default:return[]}};return e.jsxs("div",{className:"bg-white ",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 mb-4",children:[e.jsx("div",{className:"tabs tabs-boxed bg-gray-100 p-1 rounded-lg overflow-x-auto",children:Ae.map(t=>e.jsx("button",{className:`tab flex-1 min-w-fit ${c===t.id?"tab-active bg-white shadow-sm":""}`,onClick:()=>{l(t.id),A("")},children:e.jsx("strong",{children:t.label})},t.id))}),e.jsxs("button",{className:"btn btn-ghost btn-sm md:btn-md",onClick:f,disabled:m,children:[e.jsx(Ne,{})," Refresh All"]})]}),e.jsx("div",{className:"mb-4 flex flex-col md:flex-row items-center justify-between gap-2",children:e.jsxs("div",{className:"join w-full",children:[e.jsxs("select",{className:"join-item select select-bordered select-sm md:select-md",value:N,onChange:t=>Y(t.target.value),children:[e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"phone",children:"Phone"}),e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"business",children:"Business"})]}),e.jsx("input",{type:"text",className:"join-item input input-bordered w-full input-sm md:input-md",placeholder:`Search by ${N}`,value:V,onChange:t=>A(t.target.value),onKeyUp:t=>t.key==="Enter"&&M()}),e.jsx("button",{className:"join-item btn btn-primary btn-sm md:btn-md",onClick:M,disabled:m,children:"Search"}),e.jsx("button",{className:"join-item btn btn-ghost btn-sm md:btn-md",onClick:_,disabled:m,children:"Clear"})]})}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200",children:e.jsx("div",{className:"max-h-[70vh] overflow-y-auto",children:e.jsxs("table",{className:"table table-zebra table-pin-rows",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 font-bold text-black",children:e.jsx("tr",{children:R().map(t=>e.jsx("th",{className:"sticky top-0",children:t},t))})}),e.jsx("tbody",{children:m?e.jsx("tr",{children:e.jsx("td",{colSpan:R().length,className:"text-center py-8",children:e.jsx("span",{className:"loading loading-spinner loading-lg"})})}):s.length>0?s.map((t,h)=>e.jsx(Se,{vendor:t,index:h,activeTab:c,onView:()=>k(t),onReview:()=>D(t),onApprove:o,onReject:r,onMarkDefaultStockist:u,onToggleStatus:r,onMarkKycCompleted:()=>{I(t),v(!0)},onAssignStockist:$,onRefresh:p,isLoadingAction:y,currentActionId:P,setShowKycModal:v,setSelectedVendor:I,role:d},t.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:R().length,className:"text-center py-8 text-gray-500",children:["No ",c==="new"?"applications":d," found"]})})})]})})}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"loading loading-spinner loading-md"}),children:[w&&e.jsx(B,{children:e.jsx(ke,{user:w,onClose:()=>k(null)})}),i&&e.jsx(B,{children:e.jsx(Ce,{vendor:i,role:d,onClose:()=>D(null)})}),C&&e.jsx(B,{children:e.jsx(ve,{onConfirm:q,onCancel:()=>v(!1),isLoading:y&&P===((U=g==null?void 0:g.user)==null?void 0:U.id)})})]}),L&&e.jsx(B,{children:e.jsx(we,{isOpen:L,onClose:()=>{T(!1),E(null),K(null)},reseller:H,currentStockist:z})})]})}function De({onClose:s,onSubmit:c}){const[l,o]=n.useState(""),[r,u]=n.useState(!1),j=async p=>{if(p.preventDefault(),!(!l.trim()||r))try{u(!0),await c(l),s()}catch(m){console.error("Submission failed:",m)}finally{u(!1)}};return e.jsx(B,{children:e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Provide Rejection Reason"}),e.jsxs("form",{onSubmit:j,className:"mt-4",children:[e.jsx("textarea",{className:"textarea textarea-bordered w-full",placeholder:"Enter reason for rejection...",value:l,onChange:p=>o(p.target.value),required:!0,disabled:r}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",className:"btn",onClick:s,disabled:r,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-error",disabled:!l.trim()||r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner loading-xs"}),"Submitting..."]}):"Submit Rejection"})]})]})]})})})}export{De as R,Pe as V};
