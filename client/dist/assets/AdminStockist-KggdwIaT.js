import{r,aB as Y,aH as _,aI as G,aE as O,aF as Q,aG as V,aJ as $,j as l,y as a}from"./index-oHO_bMXB.js";import{V as B,R as H}from"./RejectReasonModal-R1o-yz2x.js";import"./format-PgvnqH7J.js";import"./en-US-CEmq6YZe.js";import"./ModalPortal-CaX2GLzp.js";import"./index-DsfZBStp.js";function ee(){const[c,y]=r.useState("new"),[S,p]=r.useState(!1),[k,g]=r.useState(null),[u,w]=r.useState({searchTerm:"",searchType:"email"}),[h,i]=r.useState(!1),[m,o]=r.useState(null),{data:A=[],isLoading:j,refetch:d}=Y(["new","pending","rejected"].includes(c)?{status:c,search:u.searchTerm,search_type:u.searchType,role:"stockist"}:null,{skip:!["new","pending","rejected"].includes(c)}),{data:x=[],isLoading:v,refetch:f}=_(["active","suspended"].includes(c)?{status:c,search:u.searchTerm,search_type:u.searchType}:null,{skip:!["active","suspended"].includes(c)}),[M]=G(),[R]=O(),[T]=Q(),[L]=V(),[b]=$(),C=j||v,F=()=>["new","pending","rejected"].includes(c)?A:x,K=(e,t)=>{w({searchTerm:e,searchType:t})},U=async e=>{try{e==="all"&&(["new","pending","rejected"].includes(c)?await d():await f(),a.success("Data refreshed successfully"))}catch{a.error("Failed to refresh data")}},D=async e=>{var t;i(!0);try{await L({userId:e}).unwrap(),a.success("KYC marked as completed successfully"),d()}catch(s){a.error(((t=s==null?void 0:s.data)==null?void 0:t.message)||"Something went wrong while verifying KYC")}finally{i(!1)}},I=async(e,t="approve")=>{var s;i(!0),o(t);try{await R(e).unwrap(),a.success(t==="kyc"?"KYC marked as completed successfully":"Application Status Updated"),d()}catch(n){a.error(((s=n==null?void 0:n.data)==null?void 0:s.message)||"Something went wrong")}finally{i(!1),o(null)}},E=async(e,t)=>{var s;i(!0),o("reject");try{await T({id:e,reason:t}).unwrap(),a.success("Application rejected!"),p(!1),d()}catch(n){a.error(((s=n==null?void 0:n.data)==null?void 0:s.message)||"Failed to reject application")}finally{i(!1),o(null)}},N=async e=>{i(!0),o("status");try{await M({id:e,data:{status:c==="active"?"suspended":"active"}}).unwrap(),a.success("User Profile Status Updated"),f()}catch{a.error("Failed to update stockist status")}finally{i(!1),o(null)}},P=async(e,t)=>{var s;i(!0),o(`default-${e}`);try{await b({id:e,is_default:t}).unwrap(),a.success(`Stockist ${t?"marked as default":"removed from default"} successfully`),f()}catch(n){a.error(((s=n==null?void 0:n.data)==null?void 0:s.message)||"Failed to update default stockist status")}finally{i(!1),o(null)}};return l.jsxs("div",{className:"p-2 md:p-4",children:[l.jsx("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-4 gap-4",children:l.jsx("h1",{className:"text-xl md:text-2xl font-bold",children:"Stockist Management"})}),l.jsx(B,{data:F(),activeTab:c,setActiveTab:y,onApprove:I,MarkFullKyc:D,onReject:e=>{["new","pending","rejected"].includes(c)?(g(e),p(!0)):N(e)},onMarkDefaultStockist:P,onSearch:K,onRefresh:U,isLoading:C,isLoadingAction:h,currentActionId:m,role:"stockist"}),S&&l.jsx(H,{onClose:()=>p(!1),onSubmit:e=>E(k,e),isLoading:h&&m==="reject"})]})}export{ee as default};
