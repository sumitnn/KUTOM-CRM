import{r as i,aB as P,bL as Y,bM as D,aE as G,aF as O,aG as Q,j as o,y as a}from"./index-oHO_bMXB.js";import{V,R as _}from"./RejectReasonModal-R1o-yz2x.js";import"./format-PgvnqH7J.js";import"./en-US-CEmq6YZe.js";import"./ModalPortal-CaX2GLzp.js";import"./index-DsfZBStp.js";function X(){const[s,y]=i.useState("new"),[A,p]=i.useState(!1),[g,w]=i.useState(null),[u,j]=i.useState({searchTerm:"",searchType:"email"}),[h,n]=i.useState(!1),[f,l]=i.useState(null),{data:S=[],isLoading:R,refetch:d}=P(["new","pending","rejected"].includes(s)?{status:s,search:u.searchTerm,search_type:u.searchType,role:"reseller"}:null,{skip:!["new","pending","rejected"].includes(s)}),{data:x=[],isLoading:v,refetch:m}=Y(["active","suspended"].includes(s)?{status:s,search:u.searchTerm,search_type:u.searchType}:null,{skip:!["active","suspended"].includes(s)}),[M]=D(),[b]=G(),[L]=O(),[T]=Q(),k=R||v,C=()=>["new","pending","rejected"].includes(s)?S:x,K=(e,t)=>{j({searchTerm:e,searchType:t})},U=async e=>{try{e==="all"&&(["new","pending","rejected"].includes(s)?await d():await m(),a.success("Data refreshed successfully"))}catch{a.error("Failed to refresh data")}},F=async e=>{var t;n(!0);try{await T({userId:e}).unwrap(),a.success("KYC marked as completed successfully"),d()}catch(c){a.error(((t=c==null?void 0:c.data)==null?void 0:t.message)||"Something went wrong while verifying KYC")}finally{n(!1)}},E=async(e,t="approve")=>{var c;n(!0),l(t);try{await b(e).unwrap(),a.success(t==="kyc"?"KYC marked as completed successfully":"Application Status Updated"),d()}catch(r){a.error(((c=r==null?void 0:r.data)==null?void 0:c.message)||"Something went wrong")}finally{n(!1),l(null)}},I=async(e,t)=>{var c;n(!0),l("reject");try{await L({id:e,reason:t}).unwrap(),a.success("Application rejected!"),p(!1),d()}catch(r){a.error(((c=r==null?void 0:r.data)==null?void 0:c.message)||"Failed to reject application")}finally{n(!1),l(null)}},N=async e=>{n(!0),l("status");try{await M({id:e,data:{status:s==="active"?"suspended":"active"}}).unwrap(),a.success("User Profile Status Updated"),m()}catch{a.error("Failed to update reseller status")}finally{n(!1),l(null)}};return o.jsxs("div",{className:"p-2 md:p-4",children:[o.jsx("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-4 gap-4",children:o.jsx("h1",{className:"text-xl md:text-2xl font-bold",children:"Reseller Management"})}),o.jsx(V,{data:C(),activeTab:s,setActiveTab:y,onApprove:E,MarkFullKyc:F,onReject:e=>{["new","pending","rejected"].includes(s)?(w(e),p(!0)):N(e)},onSearch:K,onRefresh:U,isLoading:k,isLoadingAction:h,currentActionId:f,role:"reseller"}),A&&o.jsx(_,{onClose:()=>p(!1),onSubmit:e=>I(g,e),isLoading:h&&f==="reject"})]})}export{X as default};
