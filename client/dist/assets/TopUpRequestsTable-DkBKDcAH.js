import{cE as ce,cF as xe,r as n,j as e,cG as J,y as C}from"./index-0HRytCPr.js";import{C as me,j as ue,E as z,G as X,u as L,k as Q,H as K,N as he,g as pe,n as ge,o as be,b as W,ac as je}from"./index--WZidvUd.js";import{M as Y}from"./ModalPortal-Boos_dt6.js";import"./index-D-omREhy.js";const fe=[{value:"INVALID_SCREENSHOT",label:"Invalid Screenshot"},{value:"INVALID_AMOUNT",label:"Invalid Amount"},{value:"REJECTED",label:"Other Reason"}],Z={PENDING:"bg-yellow-100 text-yellow-800 border border-yellow-200",APPROVED:"bg-green-100 text-green-800 border border-green-200",INVALID_SCREENSHOT:"bg-red-100 text-red-800 border border-red-200",INVALID_AMOUNT:"bg-red-100 text-red-800 border border-red-200",REJECTED:"bg-red-100 text-red-800 border border-red-200"},q={upi:"bg-purple-100 text-purple-800",bank:"bg-blue-100 text-blue-800",card:"bg-orange-100 text-orange-800"},I=10,Ie=()=>{const{data:S={results:[]},isLoading:ee,refetch:E,error:Ne,isError:se}=ce(),te=S.results||[],[F,{isLoading:y}]=xe(),[D,ae]=n.useState(null),[M,v]=n.useState({open:!1,requestId:null}),[w,_]=n.useState(""),[T,A]=n.useState(""),[l,re]=n.useState(""),[r,R]=n.useState(1),[k,le]=n.useState("ALL"),[P,ne]=n.useState(null),U="https://via.placeholder.com/150?text=No+Image",f=te.filter(s=>{var i,d,o,c,x,m,u,h,p,g,b,j;const t=((d=(i=s.user)==null?void 0:i.username)==null?void 0:d.toLowerCase().includes(l.toLowerCase()))||((c=(o=s.user)==null?void 0:o.email)==null?void 0:c.toLowerCase().includes(l.toLowerCase()))||((m=(x=s.user)==null?void 0:x.phone)==null?void 0:m.includes(l))||((h=(u=s.user)==null?void 0:u.stockist_id)==null?void 0:h.toLowerCase().includes(l.toLowerCase()))||((g=(p=s.user)==null?void 0:p.reseller_id)==null?void 0:g.toLowerCase().includes(l.toLowerCase()))||((b=s.amount)==null?void 0:b.toString().includes(l))||((j=s.status)==null?void 0:j.toLowerCase().includes(l.toLowerCase())),a=k==="ALL"||s.status===k;return t&&a}),N=Math.ceil(f.length/I),$=f.slice((r-1)*I,r*I),O=s=>{ae(s||U),document.getElementById("screenshot_modal").showModal()},ie=s=>{const t=document.createElement("a");t.href=s||U,t.download="screenshot.jpg",document.body.appendChild(t),t.click(),document.body.removeChild(t)},V=async s=>{try{await F({topupId:s,data:{status:"approved"}}).unwrap(),C.success("Request approved successfully."),E()}catch(t){console.error(t),C.error("Failed to approve request.")}},de=async()=>{if(!w){C.error("Please select a rejection reason.");return}try{await F({topupId:M.requestId,data:{status:"rejected",rejected_reason:`${T} || ${w}`}}).unwrap(),C.success("Request rejected."),v({open:!1,requestId:null}),_(""),A(""),E()}catch(s){console.error(s),C.error("Failed to reject request.")}},G=s=>{const t={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(s).toLocaleDateString(void 0,t)},B=s=>s.stockist_id||s.reseller_id||s.vendor_id||"N/A",H=s=>s?s.toUpperCase():"N/A",oe=s=>{ne(P===s?null:s)};return n.useEffect(()=>{R(1)},[l,k]),e.jsxs("div",{className:"container mx-auto px-0",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-6 sm:px-6 lg:px-8 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Top-up Requests"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[f.length," request",f.length!==1?"s":""," found",S.count!==void 0&&` (${S.count} total)`]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-grow max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(me,{className:"text-gray-400 h-5 w-5"})}),e.jsx("input",{type:"text",placeholder:"Search by user, email, phone, ID...",className:"pl-10 pr-4 py-3 border border-gray-300 rounded-xl w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",value:l,onChange:s=>re(s.target.value)})]}),e.jsxs("select",{className:"border border-gray-300 rounded-xl cursor-pointer px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white",value:k,onChange:s=>le(s.target.value),children:[e.jsx("option",{value:"ALL",children:"All Statuses"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"INVALID_SCREENSHOT",children:"Invalid Screenshot"}),e.jsx("option",{value:"INVALID_AMOUNT",children:"Invalid Amount"}),e.jsx("option",{value:"REJECTED",children:"Rejected"})]})]})]})}),ee?e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):se?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-red-500 mb-4 text-lg",children:"Failed to load data"}),e.jsx("button",{onClick:E,className:"btn btn-outline btn-primary",children:"Retry"})]}):f.length===0?e.jsxs("div",{className:"text-center py-20 text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”"}),e.jsx("div",{className:"text-xl font-medium mb-2",children:"No requests found"}),e.jsx("div",{className:"text-gray-400",children:"No top-up requests match your current filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"lg:hidden",children:$.map(s=>{var t,a,i,d,o,c,x,m,u,h,p,g,b,j;return e.jsxs("div",{className:"border-b border-gray-200 last:border-b-0 p-6 hover:bg-gray-50 transition-colors duration-150",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-semibold text-sm",children:((a=(t=s.user)==null?void 0:t.username)==null?void 0:a.charAt(0))||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:(i=s.user)==null?void 0:i.username}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:((d=s.user)==null?void 0:d.role)||"N/A"})]})]})}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${Z[s.status]||"bg-gray-100 text-gray-800"}`,children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Amount"}),e.jsxs("div",{className:"font-semibold text-green-600 flex items-center",children:[e.jsx(J,{className:"mr-1"})," ",s.amount]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Payment Method"}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium inline-block ${q[s.payment_method]||"bg-gray-100 text-gray-800"}`,children:H(s.payment_method)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"User ID"}),e.jsx("div",{className:"font-medium text-gray-900",children:B(s.user)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Date"}),e.jsx("div",{className:"font-medium text-gray-900 text-xs",children:G(s.created_at)})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("button",{onClick:()=>oe(s.id),className:"flex items-center gap-2 text-sm text-blue-600 hover:text-blue-700 font-medium mb-3",children:[e.jsx(ue,{className:"w-4 h-4"}),P===s.id?"Hide Details":"Show Details"]}),P===s.id&&e.jsx("div",{className:"space-y-3 text-sm bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Email"}),e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-gray-400"}),((o=s.user)==null?void 0:o.email)||"N/A"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Phone"}),e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-gray-400"}),((c=s.user)==null?void 0:c.phone)||"N/A"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Payment Details"}),e.jsx("div",{className:"font-medium text-gray-900 text-xs bg-white p-2 rounded border",children:s.payment_method==="upi"?e.jsx("div",{children:e.jsxs("div",{children:["UPI ID: ",((m=(x=s.payment_details)==null?void 0:x.details)==null?void 0:m.upi_id)||"N/A"]})}):s.payment_method==="bank"?e.jsxs("div",{children:[e.jsxs("div",{children:["Bank: ",((h=(u=s.payment_details)==null?void 0:u.details)==null?void 0:h.bank_name)||"N/A"]}),e.jsxs("div",{children:["Account: ",((g=(p=s.payment_details)==null?void 0:p.details)==null?void 0:g.account_number)||"N/A"]}),e.jsxs("div",{children:["IFSC: ",((j=(b=s.payment_details)==null?void 0:b.details)==null?void 0:j.ifsc_code)||"N/A"]})]}):"No payment details available"})]})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>O(s.screenshot),className:"inline-flex items-center cursor-pointer px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none flex-1 justify-center",children:[e.jsx(L,{className:"mr-2 w-4 h-4"})," View Screenshot"]}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>V(s.id),disabled:y,className:"inline-flex items-center cursor-pointer px-3 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none disabled:opacity-50 flex-1 justify-center",children:[e.jsx(Q,{className:"mr-2 w-4 h-4"})," Approve"]}),e.jsxs("button",{onClick:()=>v({open:!0,requestId:s.id}),disabled:y,className:"inline-flex items-center cursor-pointer px-3 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none disabled:opacity-50 flex-1 justify-center",children:[e.jsx(K,{className:"mr-2 w-4 h-4"})," Reject"]})]})]})]},s.id)})}),e.jsx("div",{className:"hidden lg:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"User Details"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Payment Info"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Status & Date"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:$.map(s=>{var t,a,i,d,o,c,x,m,u,h,p,g,b,j;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-semibold text-sm mr-4",children:((a=(t=s.user)==null?void 0:t.username)==null?void 0:a.charAt(0))||"U"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:(i=s.user)==null?void 0:i.username}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 capitalize",children:((d=s.user)==null?void 0:d.role)||"N/A"})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),(o=s.user)==null?void 0:o.email]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),(c=s.user)==null?void 0:c.phone]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"ID: ",B(s.user)]})]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"font-semibold text-green-600 flex items-center text-lg",children:[e.jsx(J,{className:"mr-1"})," ",s.amount]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${q[s.payment_method]||"bg-gray-100 text-gray-800"}`,children:H(s.payment_method)})]}),e.jsx("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded border",children:s.payment_method==="upi"?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"UPI Transfer"}),e.jsxs("div",{children:["UPI ID: ",((m=(x=s.payment_details)==null?void 0:x.details)==null?void 0:m.upi_id)||"N/A"]})]}):s.payment_method==="bank"?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Bank Transfer"}),e.jsxs("div",{children:["Bank: ",((h=(u=s.payment_details)==null?void 0:u.details)==null?void 0:h.bank_name)||"N/A"]}),e.jsxs("div",{children:["Account: ",((g=(p=s.payment_details)==null?void 0:p.details)==null?void 0:g.account_number)||"N/A"]}),e.jsxs("div",{children:["IFSC: ",((j=(b=s.payment_details)==null?void 0:b.details)==null?void 0:j.ifsc_code)||"N/A"]})]}):"No payment details available"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:`px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full ${Z[s.status]||"bg-gray-100 text-gray-800"}`,children:s.status}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),G(s.created_at)]})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>O(s.screenshot),className:"inline-flex items-center cursor-pointer px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none",children:[e.jsx(L,{className:"mr-2 w-4 h-4"})," Screenshot"]}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>V(s.id),disabled:y,className:"inline-flex items-center cursor-pointer px-3 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Q,{className:"mr-2 w-4 h-4"})," Approve"]}),e.jsxs("button",{onClick:()=>v({open:!0,requestId:s.id}),disabled:y,className:"inline-flex items-center cursor-pointer px-3 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"mr-2 w-4 h-4"})," Reject"]})]})]})})]},s.id)})})]})}),N>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-4 bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",e.jsx("span",{className:"font-semibold",children:(r-1)*I+1})," to"," ",e.jsx("span",{className:"font-semibold",children:Math.min(r*I,f.length)})," ","of ",e.jsx("span",{className:"font-semibold",children:f.length})," results"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>R(s=>Math.max(s-1,1)),disabled:r===1,className:"p-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(ge,{className:"w-5 h-5"})}),Array.from({length:Math.min(5,N)},(s,t)=>{let a;return N<=5||r<=3?a=t+1:r>=N-2?a=N-4+t:a=r-2+t,e.jsx("button",{onClick:()=>R(a),className:`px-3 py-2 border rounded-lg text-sm font-medium transition-colors ${r===a?"bg-blue-500 text-white border-blue-500":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"}`,children:a},a)}),e.jsx("button",{onClick:()=>R(s=>Math.min(s+1,N)),disabled:r===N,className:"p-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]})]})]})]}),e.jsx(Y,{children:e.jsxs("dialog",{id:"screenshot_modal",className:"modal",children:[e.jsxs("div",{className:"modal-box max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Payment Screenshot"}),e.jsx("button",{onClick:()=>document.getElementById("screenshot_modal").close(),className:"btn btn-sm btn-circle btn-ghost",children:e.jsx(W,{})})]}),e.jsx("div",{className:"bg-gray-100 rounded-lg p-4 mb-4 flex-1 flex justify-center items-center overflow-auto",children:D?e.jsx("img",{src:D,alt:"Payment Screenshot",className:"max-h-full max-w-full object-contain rounded"}):e.jsxs("div",{className:"py-20 text-gray-400 text-center",children:[e.jsx(L,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("div",{children:"No image available"})]})}),e.jsx("div",{className:"modal-action",children:e.jsxs("button",{onClick:()=>ie(D),className:"btn btn-primary gap-2",children:[e.jsx(je,{className:"w-4 h-4"})," Download"]})})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{children:"close"})})]})}),e.jsx(Y,{children:e.jsx("dialog",{id:"reject_modal",className:`modal ${M.open?"modal-open":""}`,children:e.jsxs("div",{className:"modal-box max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Reject Top-up Request"}),e.jsx("button",{onClick:()=>{v({open:!1,requestId:null}),_(""),A("")},className:"btn btn-sm btn-circle btn-ghost",children:e.jsx(W,{})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:["Reason for rejection ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{className:"select select-bordered w-full cursor-pointer focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:w,onChange:s=>_(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a reason"}),fe.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Additional details (optional)"}),e.jsx("textarea",{className:"textarea textarea-bordered w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,placeholder:"Provide more information about why this request is being rejected...",value:T,onChange:s=>A(s.target.value)})]})]}),e.jsxs("div",{className:"modal-action mt-8",children:[e.jsx("button",{onClick:()=>{v({open:!1,requestId:null}),_(""),A("")},className:"btn btn-ghost",children:"Cancel"}),e.jsx("button",{onClick:de,disabled:!w||y,className:`btn btn-error gap-2 ${w?"":"btn-disabled"}`,children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner"}),"Processing..."]}):"Confirm Rejection"})]})]})})})]})};export{Ie as default};
